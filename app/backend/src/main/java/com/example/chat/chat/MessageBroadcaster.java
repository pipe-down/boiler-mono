package com.example.chat.chat; import reactor.core.publisher.*; import org.springframework.stereotype.*; import java.util.concurrent.*; @Component public class MessageBroadcaster{ private final ConcurrentHashMap<String,Sinks.Many<TimelineStore.MessageDTO>> sinks=new ConcurrentHashMap<>(); public void emit(String room, TimelineStore.MessageDTO dto){ sinks.computeIfAbsent(room,k->Sinks.many().multicast().onBackpressureBuffer()).tryEmitNext(dto);} public Flux<TimelineStore.MessageDTO> stream(String room){ return sinks.computeIfAbsent(room,k->Sinks.many().multicast().onBackpressureBuffer()).asFlux(); } }