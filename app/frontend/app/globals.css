@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --font-size: 14px;
    --background: #ffffff;
    --foreground: oklch(0.145 0 0);
    --card: #ffffff;
    --card-foreground: oklch(0.145 0 0);
    --popover: #ffffff;
    --popover-foreground: oklch(0.145 0 0);
    --primary: #030213;
    --primary-foreground: #ffffff;
    --secondary: oklch(0.95 0.0058 264.53);
    --secondary-foreground: #030213;
    --muted: #ececf0;
    --muted-foreground: #717182;
    --accent: #e9ebef;
    --accent-foreground: #030213;
    --destructive: #d4183d;
    --destructive-foreground: #ffffff;
    --border: rgba(0, 0, 0, 0.1);
    --input: transparent;
    --input-background: #f3f3f5;
    --switch-background: #cbced4;
    --font-weight-medium: 500;
    --font-weight-normal: 400;
    --ring: oklch(0.708 0 0);
    --radius: 0.625rem;
    --app-header-height: 72px;
    /* default overlay for light mode */
    --overlay: oklch(0 0 0 / 0.5);

    --sidebar: oklch(0.985 0 0);
    --sidebar-foreground: oklch(0.145 0 0);
    --sidebar-primary: #030213;
    --sidebar-primary-foreground: oklch(0.985 0 0);
    --sidebar-accent: oklch(0.97 0 0);
    --sidebar-accent-foreground: oklch(0.205 0 0);
    --sidebar-border: oklch(0.922 0 0);
    --sidebar-ring: oklch(0.708 0 0);

    --chart-1: oklch(0.646 0.222 41.116);
    --chart-2: oklch(0.6 0.118 184.704);
    --chart-3: oklch(0.398 0.07 227.392);
    --chart-4: oklch(0.828 0.189 84.429);
    --chart-5: oklch(0.769 0.188 70.08);
  }

  .dark {
    /* Softer dark theme to avoid pitch black */
    --background: oklch(0.18 0.006 240);
    --foreground: oklch(0.94 0.01 240);

    --card: oklch(0.21 0.01 240);
    --card-foreground: oklch(0.93 0.01 240);

    --popover: oklch(0.23 0.012 240);
    --popover-foreground: oklch(0.93 0.01 240);

    --primary: oklch(0.75 0.15 250);
    --primary-foreground: oklch(0.06 0.01 240);

    --secondary: oklch(0.21 0.02 240);
    --secondary-foreground: oklch(0.86 0.01 240);

    --muted: oklch(0.22 0.02 240);
    --muted-foreground: oklch(0.72 0.02 240);

    --accent: oklch(0.24 0.03 250);
    --accent-foreground: oklch(0.92 0.01 240);

    --destructive: oklch(0.62 0.18 15);
    --destructive-foreground: oklch(0.96 0.01 240);

    --border: oklch(0.31 0.02 240);
    --app-header-height: 72px;

    --input: oklch(0.21 0.02 240);
    --input-background: oklch(0.21 0.02 240);

    --switch-background: oklch(0.34 0.02 240);
    --ring: oklch(0.75 0.15 250);

    /* dark-mode overlay is slightly lighter than 0.5 to reduce heaviness */
    --overlay: oklch(0 0 0 / 0.4);

    --sidebar: oklch(0.19 0.01 240);
    --sidebar-foreground: oklch(0.92 0.01 240);
    --sidebar-primary: oklch(0.75 0.15 250);
    --sidebar-primary-foreground: oklch(0.06 0.01 240);
    --sidebar-accent: oklch(0.22 0.02 240);
    --sidebar-accent-foreground: oklch(0.86 0.01 240);
    --sidebar-border: oklch(0.3 0.02 240);
    --sidebar-ring: oklch(0.75 0.15 250);

    --chart-1: oklch(0.65 0.2 250);
    --chart-2: oklch(0.7 0.15 180);
    --chart-3: oklch(0.75 0.18 60);
    --chart-4: oklch(0.68 0.2 300);
    --chart-5: oklch(0.72 0.16 30);
  }
}

@layer base {
  * {
    @apply border-border;
  }
  html {
    font-size: var(--font-size);
    color-scheme: light;
  }
  html.dark {
    color-scheme: dark;
  }
  body {
    @apply bg-background text-foreground;
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
    min-height: 100dvh;
    overflow-x: hidden;
  }
  /* Subtle dark background texture (softened to match new tones) */
  .dark body {
    background:
      radial-gradient(circle at 20% 80%, oklch(0.21 0.025 270 / 0.6) 0%, transparent 55%),
      radial-gradient(circle at 80% 20%, oklch(0.2 0.02 200 / 0.55) 0%, transparent 55%),
      var(--background);
  }
  /* Selection styling */
  ::selection {
    background: var(--accent);
    color: var(--accent-foreground);
  }
  .dark ::selection {
    background: var(--primary);
    color: var(--primary-foreground);
  }
  /* Reduced motion: disable popper/menu animations for motion-sensitive users */
  @media (prefers-reduced-motion: reduce) {
    [data-radix-popper-content-wrapper],
    [data-radix-popper-content-wrapper] *,
    [data-side],
    [data-state='open'],
    [data-state='closed'],
    [data-motion],
    [data-motion^='from-'],
    [data-motion^='to-'] {
      animation: none !important;
      transition: none !important;
    }
  }

  /* Scrollbar styling */
  ::-webkit-scrollbar {
    width: 10px;
    height: 10px;
  }
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  ::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.25);
    border-radius: 5px;
    border: 2px solid transparent;
    background-clip: content-box;
  }
  .dark ::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 5px;
    border: 2px solid transparent;
    background-clip: content-box;
  }
}

@layer components {
  .bubble {
    --bubble-pad-x: 0.95rem;
    --bubble-pad-y: 0.6rem;
    --bubble-min-inline: 3.6rem;
    --bubble-max-inline: 22rem;
    --bubble-tail-size: 14px;
    --bubble-tail-offset: calc(var(--bubble-pad-y) + 0.35rem);
    --bubble-tail-shadow: 0 6px 14px rgba(15, 23, 42, 0.12);
    position: relative;
    display: inline-flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 0.28rem;
    max-width: min(70vw, var(--bubble-max-inline));
    width: auto;
    min-width: clamp(var(--bubble-min-inline), calc(4ch + var(--bubble-pad-x) * 2), var(--bubble-max-inline));
    overflow: visible;
    padding: var(--bubble-pad-y) var(--bubble-pad-x);
    border-radius: 24px;
    line-height: 1.5;
    font-size: 0.95rem;
    font-variant-numeric: lining-nums;
    background: var(--bubble-bg, #ffffff);
    color: var(--bubble-fg, inherit);
    border: 1px solid rgba(15, 23, 42, 0.07);
    outline: 1px solid var(--bubble-outline, rgba(220, 224, 232, 0.92));
    outline-offset: -1px;
    box-shadow: var(--bubble-shadow, 0 12px 26px rgba(15, 23, 42, 0.16));
    word-break: break-word;
    letter-spacing: -0.0045em;
    transition: background-color 150ms ease, box-shadow 150ms ease;
  }

  .bubble > * {
    margin: 0;
    max-width: 100%;
  }

  .bubble--compact {
    padding-top: calc(var(--bubble-pad-y) - 0.2rem);
    padding-bottom: calc(var(--bubble-pad-y) - 0.2rem);
  }

  .bubble::after,
  .bubble::before {
    content: '';
    position: absolute;
    width: var(--bubble-tail-size);
    height: var(--bubble-tail-size);
    border-radius: 50%;
    opacity: 0;
    z-index: -1;
  }

  .bubble--tail-left::after,
  .bubble--tail-left::before {
    left: calc(var(--bubble-tail-size) * -0.45);
  }

  .bubble--tail-right::after,
  .bubble--tail-right::before {
    right: calc(var(--bubble-tail-size) * -0.45);
  }

  .bubble::after {
    bottom: var(--bubble-tail-offset);
    background: var(--bubble-bg, #ffffff);
    box-shadow: var(--bubble-tail-shadow);
    transform: rotate(45deg);
    opacity: 1;
  }

  .bubble::before {
    bottom: calc(var(--bubble-tail-offset) - 1px);
    background: linear-gradient(135deg, var(--bubble-tail-border, rgba(15, 23, 42, 0.05)) 0%, transparent 100%);
    transform: rotate(45deg);
    opacity: 1;
  }
}

/*
  Compatibility layer for vendor prefixes that autoprefixer might miss
  if the browserslist configuration is not optimal.
*/
@layer utilities {
  .select-none {
    -webkit-user-select: none;
    user-select: none;
  }

  .scrollbar-hidden {
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  .scrollbar-hidden::-webkit-scrollbar {
    width: 0;
    height: 0;
  }
}

/* Dark-mode compatibility overrides for legacy hard-coded text colors */
@layer utilities {
  .dark .text-black,
  .dark .text-slate-900,
  .dark .text-slate-800,
  .dark .text-slate-700 {
    color: var(--foreground) !important;
  }

  .dark .text-slate-600,
  .dark .text-slate-500 {
    color: var(--muted-foreground) !important;
  }
}

/* Base typography (applies when no explicit Tailwind text-* size overrides) */
@layer base {
  h1 {
    font-size: clamp(1.5rem, 1.3vw + 1.1rem, 2rem);
    font-weight: var(--font-weight-medium);
    line-height: 1.5;
  }
  h2 {
    font-size: clamp(1.25rem, 1vw + 0.95rem, 1.5rem);
    font-weight: var(--font-weight-medium);
    line-height: 1.5;
  }
  h3 {
    font-size: clamp(1.125rem, 0.8vw + 0.85rem, 1.25rem);
    font-weight: var(--font-weight-medium);
    line-height: 1.5;
  }
  h4 {
    font-size: 1rem;
    font-weight: var(--font-weight-medium);
    line-height: 1.5;
  }
  p,
  label,
  button,
  input {
    font-size: 1rem;
    line-height: 1.5;
  }
}

/* Shorter default durations for popper/menu content */
@layer base {
  [data-slot='dropdown-menu-content'],
  [data-slot='select-content'],
  [data-slot='popover-content'],
  [data-slot='hover-card-content'],
  [data-slot='tooltip-content'] {
    transition-duration: 140ms !important;
    animation-duration: 140ms !important;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1) !important;
  }
}
